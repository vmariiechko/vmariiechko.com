---
layout: layouts/base.njk
---

<article class="prose lg:prose-xl">
  <header>
    <h1>{{ title }}</h1>
    <p class="text-sm text-muted">
      Published on: <time datetime="{{ date | htmlDateString }}">{{ date | readableDate }}</time>
      {% if readingTime %}
        <span>&bull; {{ readingTime }} min read</span>
      {% endif %}
    </p>
    {% if tags %}
      <div class="flex flex-wrap gap-2 mt-4">
        {% for tag in tags %}
          {% if tag != 'Post' %}
            <span class="tag-chip">{{ tag }}</span>
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}
  </header>

  <div class="mt-8">
    {{ content | safe }}
  </div>

  <div id="comments" class="mt-12"></div>
  <script src="/assets/js/comments.js"></script>
</article>

{# Mermaid diagram support #}
{# <script src="/assets/js/mermaid-support.js"></script> #}
<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';

  // Convert language-mermaid code blocks to mermaid class
  document.querySelectorAll('pre.language-mermaid, code.language-mermaid').forEach(el => {
    const pre = el.tagName === 'PRE' ? el : el.parentElement;
    const code = pre.querySelector('code') || el;

    // Extract the text content (remove prism spans if any)
    const mermaidCode = code.textContent;

    // Replace the code block with a mermaid div
    const mermaidDiv = document.createElement('div');
    mermaidDiv.className = 'mermaid';
    mermaidDiv.textContent = mermaidCode;
    pre.replaceWith(mermaidDiv);
  });

  // Initialize mermaid with theme support
  const currentTheme = document.documentElement.getAttribute('data-theme');
  mermaid.initialize({
    startOnLoad: true,
    theme: currentTheme === 'light' || currentTheme === 'light-blue' ? 'default' : 'dark'
  });

  // Re-render mermaid diagrams when theme changes
  window.addEventListener('themeChanged', (e) => {
    const newTheme = e.detail.theme === 'light' || e.detail.theme === 'light-blue' ? 'default' : 'dark';
    mermaid.initialize({ theme: newTheme });
    document.querySelectorAll('.mermaid').forEach((el, index) => {
      el.removeAttribute('data-processed');
      mermaid.run({ nodes: [el] });
    });
  });
</script>